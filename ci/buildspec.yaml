version: 0.2

env:
  parameter-store:
    CODESIGN_PROFILE_ARN: '/iot/rebelthings/codesign/esp32/codesign-profile-arn'
    OTA_BUCKET_PARAMETER_URI: '/iot/rebelthings/hottopsidecar/ota-bucket'
phases:
  install:
    commands:
      - ls -tral deploy
      - ls -tral deploy/
      - ls -tral deploy/firmware
      - echo "Codesign profile ARN $CODESIGN_PROFILE_ARN"
      - echo "OTA Bucket $OTA_BUCKET_PARAMETER_URI"
  build:
    commands:
      - ./deploy/bin/sign-firmware.sh ./deploy/firmware release $OTA_BUCKET_PARAMETER_URI $CODESIGN_PROFILE_ARN
    finally:
      - echo This always runs even if the install command fails
  post_build:
    commands:
      - echo Entered the post_build phase...
